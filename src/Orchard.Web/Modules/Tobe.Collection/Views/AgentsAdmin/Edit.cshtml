@model Tobe.Collection.ViewModels.EditAgentViewModel
@{
    var albumArtistGroups = Model.RelatedAlbumArtists.GroupBy(x => x.Album).ToArray();
    var albumCreditGroups = Model.RelatedAlbumCredits.GroupBy(x => x.Album).ToArray();
}
<h2>@T("Edit Agent")</h2>
@using (Html.BeginFormAntiForgeryPost("Edit")) {
    @Html.HiddenFor(a => a.Id)
    @Html.LabelFor(a => a.Name)
    @Html.TextBoxFor(a => a.Name, new { @class = "text medium" })
    @Html.ValidationMessageFor(a => a.Name)
    @Html.TextBoxFor(a => a.NameSort, new { @class = "text medium" })
    @Html.ValidationMessageFor(a => a.NameSort)
    @Html.TextBoxFor(a => a.FileUnder, new { @class = "text medium" })
    @Html.ValidationMessageFor(a => a.FileUnder)
    <div style="margin-top: 10px">
        <button type="submit" class="primaryAction">@T("Save")</button>
    </div>
}
@if (Model.RelatedAlbumArtists.Any())
{
    <br />
    <h2>@T("Discography")</h2>
    <ul>
        @foreach (var albumArtistGroup in albumArtistGroups)
        {
        var album = albumArtistGroup.First().Album;
        var displayTextFormat = album.OriginalReleaseDate != null ? "{0} ({1})" : "{0}";
        <li>@Html.ItemEditLink(String.Format(displayTextFormat, Html.ItemDisplayText(album), album.OriginalReleaseDate), album)</li>
        }
    </ul>
}
@if (Model.RelatedAlbumCredits.Any()) {
    <br />
    <h2>@T("Production Credits")</h2>
    <ul>
        @foreach (var albumCreditGroup in albumCreditGroups) {
            var roles = String.Join(", ", albumCreditGroup.Select(x => x.Role));
            var album = albumCreditGroup.First().Album;
            var displayTextFormat = album.OriginalReleaseDate != null ? "{0} ({1})" : "{0}";
            <li>@Html.ItemEditLink(String.Format(displayTextFormat, Html.ItemDisplayText(album), album.OriginalReleaseDate), album) - <span>@roles</span></li>
        }
    </ul>
}
@if (Model.RelatedContent.Any()) {
    <br />
    <h2>@T("Related Content")</h2>
    <ul>
        @foreach (var content in Model.RelatedContent) {
            var roles = String.Join(", ", content.Credits.Where(x => x.Agent.Id == Model.Id).Select(x => x.Role.Name).Distinct());
            <li>@Html.ItemEditLink(content) - <span>@roles</span></li>
        }
    </ul>
}